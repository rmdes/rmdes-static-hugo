<!DOCTYPE html>
<html lang="{{ .Site.Language.Lang }}">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    {{/* Preconnect hints for external resources */}}
    <link rel="preconnect" href="https://giscus.app" crossorigin />
    <link rel="preconnect" href="https://webmention.io" crossorigin />
    <link rel="preconnect" href="https://img.shields.io" crossorigin />
    <link rel="preconnect" href="https://avatars.githubusercontent.com" crossorigin />

    <title>
      {{ if eq .Title .Site.Title }}
        {{ .Title }}
      {{ else }}
        {{ .Title }} |
        {{ .Site.Title }}
      {{ end }}
    </title>

    {{ range .Site.Data.links.me }}
      <link rel="me" href="{{ . }}" />
    {{ end }}

    {{/* IndieWeb endpoints and identity links */}}
    {{ if .Site.Data.integrations.indieweb.enabled }}
      {{/* Webmention endpoint for receiving mentions */}}
      {{ if .Site.Data.integrations.indieweb.webmention.enabled }}
        <link rel="webmention" href="{{ .Site.Data.integrations.indieweb.webmention.endpoint }}" />
      {{ end }}

      {{/* IndieAuth endpoints */}}
      {{ if .Site.Data.integrations.indieweb.indieauth.enabled }}
        <link rel="authorization_endpoint" href="{{ .Site.Data.integrations.indieweb.indieauth.endpoint }}" />
        <link rel="token_endpoint" href="{{ .Site.Data.integrations.indieweb.indieauth.tokenEndpoint }}" />
      {{ end }}

      {{/* Micropub endpoint */}}
      {{ if .Site.Data.integrations.indieweb.micropub.enabled }}
        <link rel="micropub" href="{{ .Site.Data.site.opengraph.baseUrl }}/api/micropub" />
      {{ end }}

      {{/* Microsub endpoint */}}
      {{ if .Site.Data.integrations.indieweb.microsub.enabled }}
        <link rel="microsub" href="{{ .Site.Data.site.opengraph.baseUrl }}/api/microsub" />
      {{ end }}

      {{/* rel=me identity verification links from socials */}}
      {{ range .Site.Data.links.socials }}
        {{ if .link }}
          <link rel="me" href="{{ .link }}" />
        {{ end }}
      {{ end }}
    {{ end }}


    <link rel="icon" href="{{ .Site.Data.person.img }}" />

    <meta name="author" content="{{ .Site.Data.site.author }}" />
    <meta name="description" content="{{ .Site.Data.site.description }}" />
    <meta
      name="keywords"
      content="{{ delimit .Site.Data.site.keywords `, ` }}"
    />
    <meta
      name="copyright"
      content="&copy; {{ now.Year }} {{ .Site.Data.site.author }}"
    />

    {{ partial "opengraph" . }}

    {{ $opts := dict
      "transpiler" "dartsass"
      "includePaths" (slice "node_modules")
    }}
    {{ with resources.Get `scss/main.scss` | resources.ExecuteAsTemplate `main.scss` . | toCSS $opts | minify | fingerprint }}
      <link rel="stylesheet" href="{{ .RelPermalink }}" integrity="{{ .Data.Integrity }}" crossorigin="anonymous" />
    {{ end }}
  </head>
  <body>
    {{ if .Site.Data.effects.fireworks }}
      {{ $built := resources.Get "js/fireworks.js" | js.Build (dict "minify" true "target" "es2015") | fingerprint }}
      <script src="{{ $built.RelPermalink }}" integrity="{{ $built.Data.Integrity }}" crossorigin="anonymous"></script>

      <fireworks-js
        style="width: 100%; height: 100%; position: fixed;"
        class="fireworks"
      ></fireworks-js>
    {{ else if .Site.Data.effects.snowfall }}
      <div class="fireworks"></div>
    {{ end }}

    {{ if .Site.Data.effects.snowfall }}
      {{ $built := resources.Get "js/snowflakes.js" | js.Build (dict "minify" true "target" "es2015") | fingerprint }}
      <script src="{{ $built.RelPermalink }}" integrity="{{ $built.Data.Integrity }}" crossorigin="anonymous"></script>
    {{ end }}

    {{ if .Site.Data.effects.rainfall }}
      <div class="rainfall">
        <div class="rainfall__borders">
          {{ range (seq 100) }}
            <div class="rainfall__border"></div>
          {{ end }}
        </div>

        <div class="rainfall__drops">
          {{ range (seq 100) }}
            <div class="rainfall__raindrop"></div>
          {{ end }}
        </div>
      </div>
    {{ end }}

    {{ if .Site.Data.effects.sunrays }}
      <div class="sunrays">
        <div class="sunrays__sun">
          <div class="sunrays__sun__ray__box">
            <div
              class="sunrays__sun__ray__box__ray sunrays__sun__ray__box__ray--1"
            ></div>
            <div
              class="sunrays__sun__ray__box__ray sunrays__sun__ray__box__ray--2"
            ></div>
            <div
              class="sunrays__sun__ray__box__ray sunrays__sun__ray__box__ray--3"
            ></div>
            <div
              class="sunrays__sun__ray__box__ray sunrays__sun__ray__box__ray--4"
            ></div>
            <div
              class="sunrays__sun__ray__box__ray sunrays__sun__ray__box__ray--5"
            ></div>
            <div
              class="sunrays__sun__ray__box__ray sunrays__sun__ray__box__ray--6"
            ></div>
            <div
              class="sunrays__sun__ray__box__ray sunrays__sun__ray__box__ray--7"
            ></div>
            <div
              class="sunrays__sun__ray__box__ray sunrays__sun__ray__box__ray--8"
            ></div>
            <div
              class="sunrays__sun__ray__box__ray sunrays__sun__ray__box__ray--9"
            ></div>
            <div
              class="sunrays__sun__ray__box__ray sunrays__sun__ray__box__ray--10"
            ></div>
          </div>
        </div>
      </div>
    {{ end }}


    <noscript
      >Please enable JavaScript to enable automatic dark theme
      switching.</noscript
    >
    <script type="module">
      const darkModeMediaQuery = window.matchMedia(
        "(prefers-color-scheme: dark)"
      );

      const updateTheme = () =>
        document.documentElement.classList.toggle(
          "pf-v6-theme-dark",
          darkModeMediaQuery.matches
        );

      darkModeMediaQuery.addEventListener("change", updateTheme);

      updateTheme();
    </script>

    <div class="pf-v6-c-page pf-v6-c-page--background">
      <a
        class="pf-v6-c-skip-to-content pf-v6-c-button pf-m-primary"
        href="#main"
        >Skip to content</a
      >

      {{ block "header" . }}
        <header
          class="pf-v6-c-page__header pf-v6-c-page__header--max-width pf-v6-x-u-blur pf-v6-c-page__header--overlay pf-v6-u-box-shadow-sm"
        >
          <div class="pf-v6-c-page__header__content--max-width">
            <a
              class="pf-v6-u-display-flex pf-v6-u-align-items-center pf-v6-u-justify-content-center pf-v6-c-page__header-brand-link--no-decoration pf-v6-u-pl-md pf-v6-u-pl-sm-on-xl pf-v6-x-u-hoverable-parent pf-v6-x-u-hoverable-parent--rotate"
              href="{{ .Site.BaseURL }}"
            >
              <img
                src="{{ .Site.Data.person.img }}"
                alt="Profile picture of {{ .Site.Data.person.name }}"
                class="pf-v6-c-avatar pf-v6-u-mr-md pf-v6-c-avatar--navbar"
              />
              <div>
                <h2 class="pf-v6-u-font-size-sm pf-v6-x-u-text-shadow-sm">
                  {{ .Site.Data.person.name }}
                </h2>
                <h1
                  class="pf-v6-u-font-size-md pf-v6-u-font-weight-bold pf-v6-x-u-navbar__title pf-v6-x-u-text-shadow-sm"
                >
                  {{ .Title }}
                </h1>
              </div>
            </a>

            {{/* Desktop navigation - hidden on mobile */}}
            <nav
              class="pf-v6-u-display-flex pf-v6-u-align-items-center pf-v6-u-pr-md pf-v6-u-pr-0-on-xl pf-v6-x-c-nav--desktop"
              aria-label="Main navigation"
            >
              {{ range .Site.Data.links.navbar }}
                <a
                  href="{{ .link }}"
                  {{ if .newTab }}target="_blank"{{ end }}
                  rel="noopener"
                  class="pf-v6-c-button pf-v6-c-button--header pf-v6-x-u-text-shadow-sm pf-m-plain pf-v6-u-ml-2xl--first-child"
                >
                  <span class="pf-v6-c-button__icon pf-m-start">
                    <i class="{{ .icon }}" aria-hidden="true"></i> </span
                  >{{ .title }}</a
                >
              {{ end }}
            </nav>

            {{/* Mobile hamburger menu toggle */}}
            <div class="pf-v6-x-c-mobile-menu pf-v6-u-pr-md">
              <button
                class="pf-v6-c-menu-toggle pf-v6-c-menu-toggle--header pf-m-plain"
                type="button"
                aria-expanded="false"
                aria-label="Toggle navigation menu"
                id="mobile-menu-toggle"
              >
                <span class="pf-v6-c-menu-toggle__icon">
                  <i class="fas fa-bars" aria-hidden="true"></i>
                </span>
              </button>

              {{/* Mobile dropdown menu */}}
              <div class="pf-v6-c-menu pf-v6-x-c-mobile-menu__dropdown" id="mobile-menu-dropdown" hidden>
                <div class="pf-v6-c-menu__content">
                  <ul class="pf-v6-c-menu__list" role="menu">
                    {{ range .Site.Data.links.navbar }}
                      <li class="pf-v6-c-menu__list-item" role="none">
                        <a
                          class="pf-v6-c-menu__item"
                          href="{{ .link }}"
                          {{ if .newTab }}target="_blank"{{ end }}
                          rel="noopener"
                          role="menuitem"
                        >
                          <span class="pf-v6-c-menu__item-icon">
                            <i class="{{ .icon }}" aria-hidden="true"></i>
                          </span>
                          <span class="pf-v6-c-menu__item-main">
                            <span class="pf-v6-c-menu__item-text">{{ .title }}</span>
                          </span>
                        </a>
                      </li>
                    {{ end }}
                  </ul>
                </div>
              </div>
            </div>
          </div>
        </header>
      {{ end }}

      {{ block "main" . }}
        <main
          class="pf-v6-c-page__main pf-v6-c-page__main--with-overlay {{ if .Site.Data.effects.grid }}
            pf-v6-c-page__main--with-overlay--grid
          {{ end }} pf-v6-x-u-blur {{ if or .Site.Data.effects.fireworks .Site.Data.effects.snowfall .Site.Data.effects.rainfall .Site.Data.effects.sunrays }}
            pf-v6-c-page__main--with-effects{{ if not .Site.Data.effects.blur }}
              pf-v6-c-page__main--with-effects--without-blur
            {{ end }}
          {{ end }}"
          tabindex="-1"
          id="main"
        >
          {{ .Content }}
        </main>
      {{ end }}

    </div>

    {{/* Mobile menu toggle script */}}
    <script type="module">
      const menuToggle = document.getElementById('mobile-menu-toggle');
      const menuDropdown = document.getElementById('mobile-menu-dropdown');

      if (menuToggle && menuDropdown) {
        menuToggle.addEventListener('click', () => {
          const isExpanded = menuToggle.getAttribute('aria-expanded') === 'true';
          menuToggle.setAttribute('aria-expanded', !isExpanded);
          menuDropdown.hidden = isExpanded;

          // Update icon
          const icon = menuToggle.querySelector('i');
          if (icon) {
            icon.classList.toggle('fa-bars', isExpanded);
            icon.classList.toggle('fa-times', !isExpanded);
          }
        });

        // Close menu when clicking outside
        document.addEventListener('click', (event) => {
          if (!menuToggle.contains(event.target) && !menuDropdown.contains(event.target)) {
            menuToggle.setAttribute('aria-expanded', 'false');
            menuDropdown.hidden = true;
            const icon = menuToggle.querySelector('i');
            if (icon) {
              icon.classList.remove('fa-times');
              icon.classList.add('fa-bars');
            }
          }
        });

        // Close menu on escape key
        document.addEventListener('keydown', (event) => {
          if (event.key === 'Escape' && !menuDropdown.hidden) {
            menuToggle.setAttribute('aria-expanded', 'false');
            menuDropdown.hidden = true;
            const icon = menuToggle.querySelector('i');
            if (icon) {
              icon.classList.remove('fa-times');
              icon.classList.add('fa-bars');
            }
            menuToggle.focus();
          }
        });
      }
    </script>
  </body>
</html>
